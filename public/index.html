<!DOCTYPE html>
<head>
  <link rel="stylesheet" href="index.css" />
  <meta
    charset="UTF-8"
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Richard's Discord Status</title>
</head>

<div class="buttons-container theme">
  <a id="music-button" class="png-button">
    <img src="files/svg/musicOff.svg" />
  </a>
  <a id="theme-changer" class="png-button">
    <img src="files/svg/theme-light-dark.svg" style="transform: scaleX(-1)" />
  </a>
  <a href="https://github.com/richardscull" class="png-button">
    <img src="files/svg/github.svg" />
  </a>
</div>

<div class="centered">
  <body id="bg" onload="getDiscordStatus()"></body>

  <div style="position: relative; display: inline-block">
    <img id="avatar" width="128" height="128" class="avatar theme" />
    <div id="status-circle" class="status theme"></div>
  </div>

  <div>
    <a id="nickname-url">
      <h1 id="nickname" class="nickname theme"></h1>
    </a>
    <p id="status-comment" class="comment theme"></p>
    <p id="activity" class="activity theme" style="white-space: pre-wrap"></p>
  </div>
</div>

<audio id="bg-music" loop autoplay>
  <source src="files/bg-music.mp3" type="audio/mpeg" />
</audio>

<script>
  const musicButton = document.getElementById("music-button");
  const themeButton = document.getElementById("theme-changer");

  const audio = document.getElementById("bg-music");
  audio.volume = 0.25;

  musicButton.addEventListener("click", function () {
    musicButton.querySelector("img").classList.toggle("active");
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  });

  function changeWebsiteTheme() {
    document.querySelectorAll(".theme img").forEach(function (img) {
      img.classList.toggle("white");
    });

    document.querySelectorAll(".theme").forEach(function (el) {
      el.classList.toggle("white");
    });

    document.body.classList.toggle("black-background");
  }

  themeButton.addEventListener("click", changeWebsiteTheme);

  if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
    changeWebsiteTheme();
  }

  const PLAYING = "ðŸ•¹ï¸ Ð˜Ð³Ñ€Ð°ÐµÑ‚ Ð²:";
  const STREAMING = "ðŸŽ¥ Ð¡Ñ‚Ñ€Ð¸Ð¼Ð¸Ñ‚:";
  const LISTENING = "ðŸŽ¶ Ð¡Ð»ÑƒÑˆÐ°ÐµÑ‚:";
  const WATCHING = "ðŸ“º Ð¡Ð¼Ð¾Ñ‚Ñ€Ð¸Ñ‚:";

  const ONLINE_COMMENT = "Ð¡Ð²Ð¾Ð±Ð¾Ð´ÐµÐ½. ÐŸÐ¾ Ð»ÑŽÐ±Ñ‹Ð¼ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð² Ð›Ð¡.";
  const IDLE_COMMENT = "Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½, Ð½Ð¾ ÑÐºÐ¾Ñ€Ð¾ Ð±ÑƒÐ´Ñƒ ÑÐ½Ð¾Ð²Ð° Ð² ÑÐµÑ‚Ð¸.";
  const DND_COMMENT = "Ð—Ð°Ð½ÑÑ‚ Ð´ÐµÐ»Ð°Ð¼Ð¸, Ð½Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°ÑŽÑÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸.";
  const OFFLINE_COMMENT = "ÐžÑ‚Ð´Ñ‹Ñ…Ð°ÑŽ, Ð¾Ñ‚Ð²ÐµÑ‚Ñ‡Ñƒ Ð¿Ð¾Ð·Ð¶Ðµ.";

  const UNDEFINED_COMMENT = "ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ.";

  async function getDiscordStatus() {
    const url = new URL(window.location.href + "api");

    await fetch(url)
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("nickname-url").href =
          "https://discordapp.com/users/" + data.userId;
        document.getElementById("nickname").textContent = data.username;

        const avatarImage = document.getElementById("avatar");
        avatarImage.src = data.avatar;
        avatarImage.style.borderWidth = "4px";

        const statusField = document.getElementById("status-comment");
        const statusCircle = document.getElementById("status-circle");

        switch (data.status) {
          case "online":
            statusColor = "#23A559";
            statusField.textContent = "ðŸ’­ " + ONLINE_COMMENT;
            break;
          case "idle":
            statusColor = "#F0B132";
            statusField.textContent = "ðŸª´ " + IDLE_COMMENT;
            break;
          case "dnd":
            statusColor = "#F23F43";
            statusField.textContent = "â›” " + DND_COMMENT;
            break;
          case "offline":
            statusColor = "#747F8D";
            statusField.textContent = "ðŸ’¤ " + OFFLINE_COMMENT;
            break;
          default:
            statusColor = "#FFFFFF";
            statusField.textContent = "âš ï¸ " + UNDEFINED_COMMENT;
            break;
        }

        statusCircle.style.backgroundColor = statusColor;
        statusCircle.style.borderWidth = "4px";

        if (data.activity) {
          document.getElementById("nickname").style.marginTop = "50px";

          const activityField = document.getElementById("activity");

          switch (data.activity.type) {
            case 0:
              activityField.textContent = `${PLAYING}\n â””â”€ ${
                data.activity.name
              } ${data.activity.details ? data.activity.details : ""}`;
              break;
            case 1:
              activityField.textContentt = `${STREAMING}\n â””â”€ ${
                data.activity.name
              } ${data.activity.details ? data.activity.details : ""}`;
              break;
            case 2:
              activityField.textContent = `${LISTENING}\n â””â”€ ${
                data.activity.details
              } â€” ${data.activity.state ? data.activity.state : ""}`;
              break;
            case 3:
              activityField.textContent = `${WATCHING}\n â””â”€ ${
                data.activity.name
              } ${data.activity.details ? data.activity.details : ""}`;
              break;
          }
        }
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  }
</script>
